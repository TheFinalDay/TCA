{"version":3,"sources":["DrawerView.tsx"],"names":["DrawerView","state","loaded","props","navigation","index","drawerWidth","navigationConfig","drawerGestureRef","React","createRef","getLockMode","descriptors","activeKey","routes","key","drawerLockMode","options","handleDrawerOpen","dispatch","DrawerActions","openDrawer","handleDrawerClose","closeDrawer","updateWidth","setState","renderNavigationView","progress","screenProps","contentComponent","contentOptions","drawerPosition","style","renderContent","lazy","unmountInactiveRoutes","descriptor","getComponent","styles","content","map","route","includes","isFocused","StyleSheet","absoluteFill","opacity","setDrawerGestureRef","ref","current","Dimensions","addEventListener","prevProps","prevLockMode","nextLockMode","removeEventListener","drawerBackgroundColor","context","ThemeColors","bodyContent","overlayColor","drawerType","sceneContainerStyle","edgeWidth","minSwipeDistance","hideStatusBar","statusBarAnimation","gestureHandlerProps","getDrawerBackgroundColor","getOverlayColor","isDrawerOpen","backgroundColor","width","nextProps","prevState","PureComponent","contextType","ThemeContext","defaultProps","create","flex"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Dimensions, StyleSheet, ViewStyle } from 'react-native';\nimport {\n  SceneView,\n  ThemeColors,\n  ThemeContext,\n  NavigationScreenProp,\n} from 'react-navigation';\nimport { ScreenContainer } from 'react-native-screens';\n\nimport * as DrawerActions from '../routers/DrawerActions';\nimport DrawerSidebar from './DrawerSidebar';\nimport DrawerGestureContext from '../utils/DrawerGestureContext';\nimport ResourceSavingScene from './ResourceSavingScene';\nimport Drawer from './Drawer';\nimport {\n  NavigationDrawerState,\n  DrawerContentComponentProps,\n  SceneDescriptorMap,\n} from '../types';\nimport { PanGestureHandler } from 'react-native-gesture-handler';\n\ntype DrawerOptions = {\n  drawerBackgroundColor?: string;\n  overlayColor?: string;\n  minSwipeDistance?: number;\n  drawerPosition: 'left' | 'right';\n  drawerType: 'front' | 'back' | 'slide';\n  drawerLockMode?: 'unlocked' | 'locked-closed' | 'locked-open';\n  keyboardDismissMode?: 'on-drag' | 'none';\n  drawerWidth: number | (() => number);\n  statusBarAnimation: 'slide' | 'none' | 'fade';\n  onDrawerClose?: () => void;\n  onDrawerOpen?: () => void;\n  sceneContainerStyle?: ViewStyle;\n  edgeWidth: number;\n  hideStatusBar?: boolean;\n  style?: ViewStyle;\n  gestureHandlerProps?: React.ComponentProps<typeof PanGestureHandler>;\n};\n\ntype Props = {\n  lazy: boolean;\n  navigation: NavigationScreenProp<NavigationDrawerState>;\n  descriptors: SceneDescriptorMap;\n  navigationConfig: DrawerOptions & {\n    contentComponent?: React.ComponentType<DrawerContentComponentProps>;\n    unmountInactiveRoutes?: boolean;\n    contentOptions?: object;\n  };\n  screenProps: unknown;\n};\n\ntype State = {\n  loaded: number[];\n  drawerWidth: number;\n};\n\n/**\n * Component that renders the drawer.\n */\nexport default class DrawerView extends React.PureComponent<Props, State> {\n  static contextType = ThemeContext;\n  static defaultProps = {\n    lazy: true,\n  };\n\n  static getDerivedStateFromProps(nextProps: Props, prevState: State) {\n    const { index } = nextProps.navigation.state;\n\n    return {\n      // Set the current tab to be loaded if it was not loaded before\n      loaded: prevState.loaded.includes(index)\n        ? prevState.loaded\n        : [...prevState.loaded, index],\n    };\n  }\n\n  state: State = {\n    loaded: [this.props.navigation.state.index],\n    drawerWidth:\n      typeof this.props.navigationConfig.drawerWidth === 'function'\n        ? this.props.navigationConfig.drawerWidth()\n        : this.props.navigationConfig.drawerWidth,\n  };\n\n  componentDidMount() {\n    // If drawerLockMode was set to `locked-open`, we should open the drawer on mount\n    if (this.getLockMode(this.props) === 'locked-open') {\n      this.handleDrawerOpen();\n    }\n\n    Dimensions.addEventListener('change', this.updateWidth);\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const prevLockMode = this.getLockMode(prevProps);\n    const nextLockMode = this.getLockMode(this.props);\n\n    if (prevLockMode !== nextLockMode) {\n      if (nextLockMode === 'locked-open') {\n        this.handleDrawerOpen();\n      } else {\n        this.handleDrawerClose();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    Dimensions.removeEventListener('change', this.updateWidth);\n  }\n\n  context!: React.ContextType<typeof ThemeContext>;\n\n  private drawerGestureRef = React.createRef<PanGestureHandler>();\n\n  private getLockMode = ({ navigation, descriptors }: Props) => {\n    const activeKey = navigation.state.routes[navigation.state.index].key;\n    const { drawerLockMode } = descriptors[activeKey].options;\n\n    return drawerLockMode;\n  };\n\n  private handleDrawerOpen = () => {\n    const { navigation } = this.props;\n\n    navigation.dispatch(\n      DrawerActions.openDrawer({\n        key: navigation.state.key,\n      })\n    );\n  };\n\n  private handleDrawerClose = () => {\n    const { navigation } = this.props;\n\n    navigation.dispatch(\n      DrawerActions.closeDrawer({\n        key: navigation.state.key,\n      })\n    );\n  };\n\n  private updateWidth = () => {\n    const drawerWidth =\n      typeof this.props.navigationConfig.drawerWidth === 'function'\n        ? this.props.navigationConfig.drawerWidth()\n        : this.props.navigationConfig.drawerWidth;\n\n    if (this.state.drawerWidth !== drawerWidth) {\n      this.setState({ drawerWidth });\n    }\n  };\n\n  private renderNavigationView = ({ progress }: any) => {\n    return (\n      <DrawerSidebar\n        screenProps={this.props.screenProps}\n        drawerOpenProgress={progress}\n        navigation={this.props.navigation}\n        descriptors={this.props.descriptors}\n        contentComponent={this.props.navigationConfig.contentComponent}\n        contentOptions={this.props.navigationConfig.contentOptions}\n        drawerPosition={this.props.navigationConfig.drawerPosition}\n        style={this.props.navigationConfig.style}\n        {...this.props.navigationConfig}\n      />\n    );\n  };\n\n  private renderContent = () => {\n    let { lazy, navigation } = this.props;\n    let { loaded } = this.state;\n    let { routes } = navigation.state;\n\n    if (this.props.navigationConfig.unmountInactiveRoutes) {\n      let activeKey = navigation.state.routes[navigation.state.index].key;\n      let descriptor = this.props.descriptors[activeKey];\n\n      return (\n        <SceneView\n          navigation={descriptor.navigation}\n          screenProps={this.props.screenProps}\n          component={descriptor.getComponent()}\n        />\n      );\n    } else {\n      return (\n        <ScreenContainer style={styles.content}>\n          {routes.map((route, index) => {\n            if (lazy && !loaded.includes(index)) {\n              // Don't render a screen if we've never navigated to it\n              return null;\n            }\n\n            let isFocused = navigation.state.index === index;\n            let descriptor = this.props.descriptors[route.key];\n\n            return (\n              <ResourceSavingScene\n                key={route.key}\n                style={[\n                  StyleSheet.absoluteFill,\n                  { opacity: isFocused ? 1 : 0 },\n                ]}\n                isVisible={isFocused}\n              >\n                <SceneView\n                  navigation={descriptor.navigation}\n                  screenProps={this.props.screenProps}\n                  component={descriptor.getComponent()}\n                />\n              </ResourceSavingScene>\n            );\n          })}\n        </ScreenContainer>\n      );\n    }\n  };\n\n  private setDrawerGestureRef = (ref: PanGestureHandler | null) => {\n    // @ts-ignore\n    this.drawerGestureRef.current = ref;\n  };\n\n  private getDrawerBackgroundColor() {\n    const { drawerBackgroundColor } = this.props.navigationConfig;\n\n    if (drawerBackgroundColor) {\n      return typeof drawerBackgroundColor === 'string'\n        ? drawerBackgroundColor\n        : drawerBackgroundColor[this.context];\n    } else {\n      return ThemeColors[this.context].bodyContent;\n    }\n  }\n\n  private getOverlayColor() {\n    const { overlayColor } = this.props.navigationConfig;\n\n    if (overlayColor) {\n      return typeof overlayColor === 'string'\n        ? overlayColor\n        : overlayColor[this.context];\n    } else {\n      return 'rgba(0,0,0,0.5)';\n    }\n  }\n\n  render() {\n    const { navigation, navigationConfig } = this.props;\n    const {\n      drawerType,\n      sceneContainerStyle,\n      edgeWidth,\n      minSwipeDistance,\n      hideStatusBar,\n      statusBarAnimation,\n      gestureHandlerProps,\n    } = navigationConfig;\n\n    const drawerLockMode = this.getLockMode(this.props);\n    const drawerBackgroundColor = this.getDrawerBackgroundColor();\n    const overlayColor = this.getOverlayColor();\n\n    return (\n      <DrawerGestureContext.Provider value={this.drawerGestureRef}>\n        <Drawer\n          open={navigation.state.isDrawerOpen}\n          gestureEnabled={\n            drawerLockMode !== 'locked-open' &&\n            drawerLockMode !== 'locked-closed'\n          }\n          onOpen={this.handleDrawerOpen}\n          onClose={this.handleDrawerClose}\n          onGestureRef={this.setDrawerGestureRef}\n          gestureHandlerProps={gestureHandlerProps}\n          drawerType={drawerType}\n          drawerPosition={this.props.navigationConfig.drawerPosition}\n          sceneContainerStyle={sceneContainerStyle}\n          drawerStyle={{\n            backgroundColor: drawerBackgroundColor,\n            width: this.state.drawerWidth,\n          }}\n          overlayStyle={{ backgroundColor: overlayColor }}\n          swipeEdgeWidth={edgeWidth}\n          swipeDistanceThreshold={minSwipeDistance}\n          hideStatusBar={hideStatusBar}\n          statusBarAnimation={statusBarAnimation}\n          renderDrawerContent={this.renderNavigationView}\n          renderSceneContent={this.renderContent}\n        />\n      </DrawerGestureContext.Provider>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  content: {\n    flex: 1,\n  },\n});\n"]}